{"title":"Hugo\u0026Stack主题的使用和装修记录","permalink":"https://www.qisihub.cn/post/site/hugo_stack_record/","date":"2024-08-10T16:32:55+08:00","content":"hugo官网|Stack官网\nstack自带小部件： Widgets | Stack\nwidgets: homepage: - type: search - type: archives params: limit: 5 - type: categories params: limit: 10 - type: tag-cloud params: limit: 10 在stack的配置文件中，搜索工具、归档工具、分类和标签都是启用的。但是启用并不代表默认会出现，依然需要各种地方指定了值才能出现。\n分类\u0026amp;标签 在你的内容文件的front matter中，需要指定tag的值和categories的值，我这里的front matter是toml格式\ntag = [\u0026#39;hugo\u0026#39;,\u0026#39;stack\u0026#39;] categories = [\u0026#34;个人网站\u0026#34;] 归档： 需要在content/post目录下新建archives.md，内容如下，不需要任何正文内容\n+++ title = \u0026#39;Archives\u0026#39; layout = \u0026#34;archives\u0026#34; hidden = true comments = false +++ layout是指定为分类样式，hidden表示该文件不会被展示出来，comments表示评论区关闭.\n其次，需要在 项目/layouts/_default 或者 主题/layouts/_default下存在archives.html，由于stack主题下默认就有这个文件，所以正常来说添加了archives.md就可以使用归档功能了。\n搜索: 增加search.md 首先是同归档类似，需要在content/post目录下新建search.md，内容如下，不需要任何正文内容\n+++ title = \u0026#34;search\u0026#34; layout = \u0026#34;search\u0026#34; hidden = true comments = false +++ 增加搜索引擎的文件 静态网站的搜索本质上是将你的文档进行分词汇总到一个json文件，实际搜索的时候就是在搜索这个json文件。比较常用的是fuse.js,lunr.js或者主题自己封装的搜索能力。\nstack主题\n增加search.html和search.json\n需要在 项目/layouts/_default 或者 主题/layouts/_default 存在两个文件（对于stack来说），分别是search.html和search.json。\n在我clone的stack版本中，这两个文件在_default并不存在，但是在/layouts/page下面是有的，所以从cp layouts/page/* layouts/_default\n成功的话，会在public/post/search目录下生成index.html index.json两个文件，主要是index.json文件\nfuse\n我有看过两个文章是使用fuse的，但是我自己都没有实验成功，加上对hugo的模板还不熟，先不折腾了。\n给hugo添加搜索功能 | 搜百谷\nhttps://ttys3.dev/blog/hugo-fast-search\nDocsy主题\n可以参考官方文档Search | Docsy\n修改总配置hugo.yaml outputs: home: - HTML - JSON page: - HTML - JSON 这里home和page两种kind都配置的原因是:\n假如你没有修改过总配置中的permalinks，那么你的博客的路径应该是 域名/p/文章名，这种情况下kind对应的是home类型\n但是假如你像我一下修改了permalinks，比如我改成了 post: /:sections/:slug，这个是为了让我的博客地址以路径+文件名来显示，但是由于有了层级关系，里面的博客文章的kind就变成了page，因此在配置的时候，将home和page两个都指定是最好的\n说实话，我其实还是不能理解这个kind的设计~\n增加评论功能： hugo支持许多评论框架，具体可以看hugo-comments|Comments | Stack，我选择的是\nTwikoo 建议跟着快速上手 | Twikoo 文档去部署一遍，我这里选用的是Hugging Face免费部署的方案。\n部署主要有两部分：一部分是生成一个mogodb的密钥串，二部分则是在hugging face上新建空间和项目，最终获得envId\n然后修改站点配置文件\nGitalk\nGitalk本身就依赖的是github的issue功能，因此不需要额外部署；但是需要创建一个OAuthApp\ncomments: enabled: true provider: gitalk twikoo: envId: https://你的项目空间.hf.space region: path: lang: gitalk: owner: github用户名 admin: github用户名 repo: 建议填博客项目，比如我的是qisiii.github.io clientID: OAuthApp创建得到 clientSecret: OAuthApp创建得到 自定义博客的路径名： slug: 一个正常的网址格式是下面这样的，其中路径的最后一段就是slug。\n\u0026lt;协议\u0026gt;://\u0026lt;主机名\u0026gt;/\u0026lt;路径\u0026gt;/\u0026lt;文件slug\u0026gt;?\u0026lt;查询字符串\u0026gt;#\u0026lt;片段\u0026gt;` 据说简短清晰的slug有助于SEO，但哪怕没有这个功能，我们的文件名很多时候也是中文的，经过编码后可读性太差。因此，设置一个简短的slug是很有必要的。\n建议在模板文件archetypes/default.md直接新增slug字段，这样就不用每个文件手动添加了\n+++ title = \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; description = \u0026#34;\u0026#34; date = {{ .Date }} image = \u0026#34;\u0026#34; draft = true slug = \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; +++ permalinks: 如果只设置slug，stack主题配置默认路径是 域名/p/slug这样子，其实对于文件的组织管理和展示路径依然不是很明朗，因此，我这里是以文件夹层级的方式生成路径。\n在总配置中，修改或者新增\npermalinks: post: /:sections/:slug 这里的:sections是指多个路径，但是hugo默认处理顶级目录会自动识别为section外，其他目录需要手动添加_index.md文件才行。\n通过Github Action进行部署 我这里是将hugo目录作为一个私有项目，而public下文件的作为github.io的pages项目，因此等于是要将hugo的public文件部署到github.io的配置下；并且我还指定了自定义域名，所以要额外添加CNAME配置，不然每次执行action，都不会生成CNAME文件\nname: GitHub Pages on: push: branches: - master # Set a branch to deploy pull_request: jobs: deploy: runs-on: ubuntu-20.04 concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.129.0\u0026#39; # 是否启用 hugo extend extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 if: ${{ github.ref == \u0026#39;refs/heads/master\u0026#39; }} with: PERSONAL_TOKEN: ${{ secrets.ACTION_TOKEN }} EXTERNAL_REPOSITORY: qisiii/qisiii.github.io # 你的GitHub Pages仓库 PUBLISH_BRANCH: master # 或者是你的GitHub Pages分支 PUBLISH_DIR: ./public commit_message: ${{ github.event.head_commit.message }} cname: custom.domain #这里填你配置页的自定义域名 基于 Github Action 自动构建 Hugo 博客 -\n【Hugo网站搭建】GitHub Action自动化部署Hugo博客 | Eddy's blog\nhttps://zenlian.github.io/github-actions-hugo/\n标签云增加数量统计\u0026amp;归档页增加标签云: Hugo Stack主题装修笔记\n增加返回顶部按钮： 添加一键返回顶部功能 | Dlog\n修改自己喜欢的指定按钮样式\n.top-link { position: fixed; bottom: 30px; right: 30px; z-index: 99; background: #066fd1; width: 35px; height: 35px; align-items: center; justify-content: center; padding: 7px; border-radius: 5px; transition: visibility .5s, opacity .8s linear; } 滚动到顶部时，需要隐藏置顶按钮，所以引用了jquery，处理逻辑\n\u0026lt;a href=\u0026#34;#top\u0026#34; aria-label=\u0026#34;go to top\u0026#34; class=\u0026#34;top-link\u0026#34; id=\u0026#34;top-link\u0026#34; accesskey=\u0026#34;g\u0026#34; style=\u0026#34;visibility: visible; opacity: 1;\u0026#34;\u0026gt; \u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;24\u0026#34; height=\u0026#34;24\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34; class=\u0026#34;icon icon-tabler icons-tabler-outline icon-tabler-chevron-up\u0026#34;\u0026gt;\u0026lt;path stroke=\u0026#34;none\u0026#34; d=\u0026#34;M0 0h24v24H0z\u0026#34; fill=\u0026#34;none\u0026#34;/\u0026gt;\u0026lt;path d=\u0026#34;M6 15l6 -6l6 6\u0026#34; /\u0026gt;\u0026lt;/svg\u0026gt; \u0026lt;/a\u0026gt; \u0026lt;script src=\u0026#34;https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt; $(window).scroll(function(){ if($(this).scrollTop()\u0026gt;300){ $(\u0026#34;#top-link\u0026#34;).show() }else{ $(\u0026#34;#top-link\u0026#34;).hide() } }) \u0026lt;/script\u0026gt; 增加友链: 参考Hugo Stack主题装修笔记Part 2，结合自己的版本和主题略有修改\n我的links.html是放在 layouts/_default下才有效，在layouts/page下面没起效\ndata/json中指定的图片路径按博客所说需要放置在assets下再挂载到static中，我直接放在了static/link-img下\n菜单-友链需要格外的配置，这里的路径是你对应的文件，我这里不是新建了一个friend文件夹，然后在下面再创建index.md,而是在post下直接创建了个friend.md\n- identifier: friends name: 友链|Friends url: /post/friends weight: 2 params: icon: friends newTab: true bing和google的收录： bing 将 Github Pages 个人博客录入搜索引擎（以 Bing 为例） - RainbowC0 - 博客园\ngoogle Google搜索收录Github Pages（Blog可以被Google搜索到） | Marvin\u0026rsquo;s blog\n图片支持放大查看~~ Hexo 折腾：利用 Fancybox 添加图片放大预览查看功能 | Tianma\n网站添加favicon 截取成圆形图作物圈图像在线-最佳图像裁剪工具\n添加Favicon到Hugo的网站中\n通过githubWebHook通知服务器自动构建 使用 GitHub Webhook 实现静态网站自动化部署 · Jimmy Song\n添加备案 在foot.customText:添加 '\u0026lt;a href=\u0026quot;https://beian.miit.gov.cn/\u0026quot; target=\u0026quot;_blank\u0026quot;\u0026gt;京ICP备2023017017号-1\u0026lt;/a\u0026gt;'\n"}